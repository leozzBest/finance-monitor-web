<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="300">
    <title>ç´«é‡‘çŸ¿ä¸š æ—¥å†…ç›‘æ§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 0.6s ease-in;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 1em;
            transition: all 0.3s;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-button.active {
            background: white;
            color: #667eea;
            font-weight: 600;
        }

        .update-time {
            font-size: 0.9em;
            opacity: 0.85;
            background: rgba(255,255,255,0.15);
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .card, .backtest-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            margin-bottom: 25px;
            animation: slideUp 0.6s ease-out;
        }

        .stats-header {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-value.green {
            color: #22c55e;
        }

        .stat-value.red {
            color: #ef4444;
        }

        .signal-banner {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            border: 3px solid;
        }

        .signal-banner.signal-buy {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }

        .signal-banner.signal-sell {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }

        .signal-banner.signal-warning-buy {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #ffc107;
        }

        .signal-banner.signal-warning-sell {
            background: linear-gradient(135deg, #ffe8cc 0%, #ffd89b 100%);
            border-color: #ff9800;
        }

        .signal-banner.signal-hold {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            border-color: #718096;
        }

        .signal-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .signal-text {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .signal-reason {
            font-size: 1.1em;
            color: #555;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .deviation-chart-wrapper {
            background: #fff;
            border-radius: 12px;
            padding: 15px 15px 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #f0f0f0;
        }

        .deviation-title {
            font-size: 0.85em;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .deviation-legend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 400;
            color: #777;
            font-size: 0.95em;
        }

        .legend-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            margin-left: 6px;
        }

        .green-dot { background: rgba(34,197,94,0.85); }
        .red-dot   { background: rgba(239,68,68,0.85); }

        .deviation-chart-container {
            position: relative;
            height: 140px;
        }

        .range-info {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 20px;
        }

        .range-item {
            text-align: center;
        }

        .range-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .range-value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .range-value.high {
            color: #ef4444;
        }

        .range-value.low {
            color: #22c55e;
        }

        /* å›æµ‹ç›¸å…³æ ·å¼ */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h3 {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }

        .best-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .backtest-table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .backtest-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .backtest-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #dee2e6;
        }

        .backtest-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .backtest-table tr.profit {
            background: #f0fdf4;
        }

        .backtest-table tr.loss {
            background: #fef2f2;
        }

        .backtest-table tr.no-trade {
            background: #f8f9fa;
            color: #999;
        }

        .backtest-table .threshold {
            font-weight: 600;
            color: #667eea;
        }

        .backtest-table .profit-rate {
            font-weight: 600;
        }

        .backtest-table tr.profit .profit-rate,
        .backtest-table tr.profit .profit-amount {
            color: #22c55e;
        }

        .backtest-table tr.loss .profit-rate,
        .backtest-table tr.loss .profit-amount {
            color: #ef4444;
        }

        .backtest-note {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .backtest-note p {
            margin: 5px 0;
        }

        .info-message {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 1.1em;
            line-height: 1.8;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.9;
        }

        footer p {
            margin: 8px 0;
            font-size: 0.9em;
        }

        /* â”€â”€ æ“ä½œé¢æ¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .trade-panel {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        .trade-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
            font-weight: 700;
            font-size: 1.05em;
            color: #333;
        }
        .trade-config {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.85em;
            color: #555;
            flex-wrap: wrap;
        }
        .trade-config label { display: flex; align-items: center; gap: 4px; }
        .trade-config input {
            border: 1px solid #ddd; border-radius: 6px;
            padding: 3px 6px; font-size: 0.9em;
        }
        .btn-cfg {
            background: #6c757d; color: #fff;
            border: none; border-radius: 6px;
            padding: 4px 12px; cursor: pointer; font-size: 0.85em;
        }
        .btn-cfg:hover { background: #5a6268; }
        .trade-status-row {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 14px; flex-wrap: wrap;
        }
        .pos-badge {
            padding: 4px 14px; border-radius: 20px;
            font-size: 0.85em; font-weight: 700;
        }
        .pos-empty { background: #f1f3f5; color: #868e96; }
        .pos-long  { background: #d3f9d8; color: #2f9e44; }
        .pos-detail { font-size: 0.85em; color: #555; }
        .trade-btns {
            display: flex; gap: 12px; margin-bottom: 14px; flex-wrap: wrap;
        }
        .btn-trade {
            flex: 1; min-width: 140px;
            padding: 12px 20px; border: none; border-radius: 10px;
            font-size: 1em; font-weight: 700; cursor: pointer;
            transition: all .15s;
        }
        .btn-buy  { background: #2f9e44; color: #fff; }
        .btn-buy:hover:not(:disabled)  { background: #237032; transform: translateY(-1px); }
        .btn-sell { background: #e03131; color: #fff; }
        .btn-sell:hover:not(:disabled) { background: #c92a2a; transform: translateY(-1px); }
        .btn-trade:disabled { opacity: 0.4; cursor: not-allowed; }
        .trade-result {
            border-radius: 10px; padding: 12px 16px;
            margin-bottom: 12px; font-size: 0.9em; line-height: 1.7;
        }
        .trade-result.win  { background: #d3f9d8; border-left: 4px solid #2f9e44; }
        .trade-result.loss { background: #ffe3e3; border-left: 4px solid #e03131; }
        .today-trades { font-size: 0.85em; }
        .today-trades-title {
            font-weight: 700; color: #555;
            margin-bottom: 8px; border-bottom: 1px solid #f0f0f0; padding-bottom: 6px;
        }
        .trade-record {
            display: flex; flex-wrap: wrap; gap: 8px;
            padding: 8px 0; border-bottom: 1px dashed #f0f0f0;
            align-items: center;
        }
        .trade-record:last-child { border-bottom: none; }
        .tr-badge {
            padding: 2px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 700;
        }
        .tr-win  { background: #d3f9d8; color: #2f9e44; }
        .tr-loss { background: #ffe3e3; color: #e03131; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            .stats-header {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 300px;
            }
            .deviation-chart-container {
                height: 110px;
            }
            .backtest-table {
                font-size: 0.85em;
            }
            .backtest-table th, .backtest-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ç´«é‡‘çŸ¿ä¸š æ—¥å†…ç›‘æ§</h1>
            <div class="subtitle">å®æ—¶ä»·æ ¼ Â· æˆäº¤å‡ä»·(VWAP) Â· T+0ç­–ç•¥å›æµ‹</div>
            
            <div class="nav-buttons">
                <a href="index.html" class="nav-button active">ğŸ“ˆ å®æ—¶ç›‘æ§</a>
                <a href="history.html" class="nav-button">ğŸ“… å†å²å›æµ‹</a>
            </div>
            
            <div class="update-time">ğŸ”„ æ›´æ–°æ—¶é—´: 2026-02-27 17:07:58</div>
        </header>

        <div class="card">
            <div class="stats-header">
                <div class="stat-box">
                    <div class="stat-label">å½“å‰ä»·æ ¼</div>
                    <div class="stat-value">Â¥39.55</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">æˆäº¤å‡ä»·(VWAP)</div>
                    <div class="stat-value">Â¥39.57</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">åç¦»åº¦</div>
                    <div class="stat-value green">-0.05%</div>
                </div>
            </div>

            <div class="signal-banner signal-hold">
                <div class="signal-icon">âšª</div>
                <div class="signal-text">æŒæœ‰è§‚æœ›</div>
                <div class="signal-reason">ä»·æ ¼æ¥è¿‘æ—¥å†…å‡ä»· (-0.05%)</div>
            </div>

            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>

            <div class="deviation-chart-wrapper">
                <div class="deviation-title">
                    ğŸ“Š åç¦»åº¦ (ä»·æ ¼ vs VWAP%)
                    <span class="deviation-legend">
                        <span class="legend-dot green-dot"></span>ä½äºVWAP â†’ ä¹°å…¥å‚è€ƒ
                        <span class="legend-dot red-dot"></span>é«˜äºVWAP â†’ å–å‡ºå‚è€ƒ
                    </span>
                </div>
                <div class="deviation-chart-container">
                    <canvas id="deviationChart"></canvas>
                </div>
            </div>

            <div class="range-info">
                <div class="range-item">
                    <div class="range-label">æœ€é«˜ä»·</div>
                    <div class="range-value high">Â¥39.97</div>
                    <div class="stat-sub">0957</div>
                </div>
                <div class="range-item">
                    <div class="range-label">æœ€ä½ä»·</div>
                    <div class="range-value low">Â¥39.09</div>
                    <div class="stat-sub">1301</div>
                </div>
                <div class="range-item">
                    <div class="range-label">æ•°æ®ç‚¹</div>
                    <div class="range-value">242</div>
                    <div class="stat-sub">0930 - 1500</div>
                </div>
            </div>
        </div>

        
    <div class="backtest-card">
        <div class="card-header">
            <h3>ğŸ¯ T+0ç­–ç•¥å›æµ‹</h3>
            <div class="best-badge">æœ€ä½³: Â±0.3% | +0.28%</div>
        </div>
        
        <div class="backtest-table-container">
            <table class="backtest-table">
                <thead>
                    <tr>
                        <th>ç­–ç•¥</th>
                        <th>çŠ¶æ€</th>
                        <th>ä¹°å…¥æ—¶é—´</th>
                        <th>ä¹°å…¥ä»·</th>
                        <th>å–å‡ºæ—¶é—´</th>
                        <th>å–å‡ºä»·</th>
                        <th>å‡€æ”¶ç›Šç‡</th>
                        <th>1000è‚¡å‡€åˆ©</th>
                    </tr>
                </thead>
                <tbody>
                    
            <tr class="profit">
                <td class="threshold">Â±0.3%</td>
                <td class="status">âœ… å®Œæˆ</td>
                <td class="time">1036</td>
                <td class="price">Â¥39.57</td>
                <td class="time">1344</td>
                <td class="price">Â¥39.70</td>
                <td class="profit-rate">+0.28%</td>
                <td class="profit-amount">Â¥+110.18</td>
            </tr>
            
            <tr class="no-trade">
                <td class="threshold">Â±0.6%</td>
                <td class="status" colspan="7">âŒ æœªå®Œæˆäº¤æ˜“</td>
            </tr>
            
            <tr class="no-trade">
                <td class="threshold">Â±0.9%</td>
                <td class="status" colspan="7">âŒ æœªå®Œæˆäº¤æ˜“</td>
            </tr>
            
                </tbody>
            </table>
        </div>
        
        <div class="backtest-note">
            <p>ğŸ“Œ ç­–ç•¥è¯´æ˜: å½“ä»·æ ¼ä½äºVWAPè¾¾é˜ˆå€¼æ—¶ä¹°å…¥ï¼Œé«˜äºVWAPè¾¾é˜ˆå€¼æ—¶å–å‡ºï¼Œæ¯æ—¥ä¸€ä¸ªæ¥å›</p>
            <p>ğŸ’° æ‰‹ç»­è´¹: åŒå‘ä¸‡åˆ†ä¹‹2.5 (ä¹°å…¥+å–å‡º)</p>
            <p>âš ï¸ å›æµ‹åŸºäºä»Šæ—¥å†å²æ•°æ®ï¼Œä»…ä¾›å‚è€ƒ</p>
        </div>
    </div>
    

        <!-- â”€â”€ æ“ä½œé¢æ¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="trade-panel" id="tradePanel">
            <div class="trade-panel-header">
                <span>ğŸ¯ T+0 æ“ä½œè®°å½•</span>
                <div class="trade-config">
                    <label>é˜ˆå€¼
                        <input type="number" id="cfgThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width:60px"> %
                    </label>
                    <label>æŒä»“
                        <input type="number" id="cfgQuantity" value="1000" min="100" step="100" style="width:70px"> è‚¡
                    </label>
                    <button class="btn-cfg" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
                </div>
            </div>

            <div class="trade-status-row" id="tradeStatusRow">
                <div id="positionBadge" class="pos-badge pos-empty">ç©ºä»“</div>
                <div id="positionDetail" class="pos-detail"></div>
            </div>

            <div class="trade-btns">
                <button id="btnBuy"  class="btn-trade btn-buy"  onclick="doTrade('buy')">âœ… å·²ä¹°å…¥ï¼ˆè®°å½•ï¼‰</button>
                <button id="btnSell" class="btn-trade btn-sell" onclick="doTrade('sell')" disabled>ğŸ”´ å·²å–å‡ºï¼ˆè®°å½•ï¼‰</button>
            </div>

            <div id="tradeResult" class="trade-result" style="display:none"></div>

            <div id="todayTrades" class="today-trades"></div>
        </div>

        <footer>
            <p>ğŸ’¡ é¡µé¢æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–° | æ•°æ®æ¥æº: è…¾è®¯è´¢ç»åˆ†é’ŸKçº¿</p>
            <p>ğŸ“Š ç­–ç•¥: åç¦»æˆäº¤å‡ä»·(VWAP)Â±0.3%è§¦å‘é€šçŸ¥ | Â±0.3% / Â±0.6% / Â±0.9%å›æµ‹å¯¹æ¯”</p>
            <p>âš ï¸ ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®® Â· æŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…</p>
        </footer>
    </div>

    <script>
        const ctx = document.getElementById('priceChart').getContext('2d');
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['0930', '0931', '0932', '0933', '0934', '0935', '0936', '0937', '0938', '0939', '0940', '0941', '0942', '0943', '0944', '0945', '0946', '0947', '0948', '0949', '0950', '0951', '0952', '0953', '0954', '0955', '0956', '0957', '0958', '0959', '1000', '1001', '1002', '1003', '1004', '1005', '1006', '1007', '1008', '1009', '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017', '1018', '1019', '1020', '1021', '1022', '1023', '1024', '1025', '1026', '1027', '1028', '1029', '1030', '1031', '1032', '1033', '1034', '1035', '1036', '1037', '1038', '1039', '1040', '1041', '1042', '1043', '1044', '1045', '1046', '1047', '1048', '1049', '1050', '1051', '1052', '1053', '1054', '1055', '1056', '1057', '1058', '1059', '1100', '1101', '1102', '1103', '1104', '1105', '1106', '1107', '1108', '1109', '1110', '1111', '1112', '1113', '1114', '1115', '1116', '1117', '1118', '1119', '1120', '1121', '1122', '1123', '1124', '1125', '1126', '1127', '1128', '1129', '1130', '1300', '1301', '1302', '1303', '1304', '1305', '1306', '1307', '1308', '1309', '1310', '1311', '1312', '1313', '1314', '1315', '1316', '1317', '1318', '1319', '1320', '1321', '1322', '1323', '1324', '1325', '1326', '1327', '1328', '1329', '1330', '1331', '1332', '1333', '1334', '1335', '1336', '1337', '1338', '1339', '1340', '1341', '1342', '1343', '1344', '1345', '1346', '1347', '1348', '1349', '1350', '1351', '1352', '1353', '1354', '1355', '1356', '1357', '1358', '1359', '1400', '1401', '1402', '1403', '1404', '1405', '1406', '1407', '1408', '1409', '1410', '1411', '1412', '1413', '1414', '1415', '1416', '1417', '1418', '1419', '1420', '1421', '1422', '1423', '1424', '1425', '1426', '1427', '1428', '1429', '1430', '1431', '1432', '1433', '1434', '1435', '1436', '1437', '1438', '1439', '1440', '1441', '1442', '1443', '1444', '1445', '1446', '1447', '1448', '1449', '1450', '1451', '1452', '1453', '1454', '1455', '1456', '1457', '1458', '1459', '1500'],
                datasets: [
                    {
                        label: 'å®æ—¶ä»·æ ¼',
                        data: [39.2, 39.4, 39.47, 39.44, 39.44, 39.44, 39.38, 39.37, 39.37, 39.44, 39.58, 39.51, 39.51, 39.49, 39.52, 39.5, 39.46, 39.6, 39.63, 39.67, 39.67, 39.72, 39.76, 39.82, 39.9, 39.92, 39.89, 39.97, 39.96, 39.85, 39.9, 39.87, 39.83, 39.78, 39.77, 39.71, 39.72, 39.68, 39.68, 39.67, 39.62, 39.7, 39.65, 39.7, 39.68, 39.77, 39.79, 39.78, 39.83, 39.82, 39.81, 39.82, 39.77, 39.78, 39.8, 39.83, 39.8, 39.77, 39.8, 39.76, 39.74, 39.74, 39.69, 39.68, 39.64, 39.63, 39.57, 39.54, 39.51, 39.49, 39.51, 39.49, 39.5, 39.47, 39.46, 39.47, 39.49, 39.53, 39.48, 39.41, 39.41, 39.4, 39.38, 39.38, 39.31, 39.34, 39.35, 39.37, 39.33, 39.33, 39.36, 39.38, 39.39, 39.39, 39.39, 39.39, 39.4, 39.42, 39.46, 39.38, 39.38, 39.36, 39.39, 39.4, 39.4, 39.39, 39.39, 39.33, 39.33, 39.34, 39.27, 39.28, 39.24, 39.22, 39.21, 39.22, 39.21, 39.2, 39.23, 39.23, 39.22, 39.22, 39.09, 39.17, 39.24, 39.23, 39.24, 39.25, 39.26, 39.27, 39.23, 39.19, 39.15, 39.17, 39.21, 39.26, 39.26, 39.26, 39.33, 39.33, 39.32, 39.35, 39.4, 39.38, 39.38, 39.39, 39.42, 39.48, 39.47, 39.47, 39.51, 39.5, 39.57, 39.59, 39.58, 39.63, 39.6, 39.55, 39.59, 39.59, 39.56, 39.59, 39.66, 39.64, 39.66, 39.7, 39.69, 39.6, 39.61, 39.64, 39.64, 39.59, 39.59, 39.59, 39.61, 39.58, 39.63, 39.67, 39.67, 39.64, 39.68, 39.65, 39.61, 39.61, 39.57, 39.55, 39.52, 39.56, 39.56, 39.56, 39.56, 39.54, 39.54, 39.54, 39.57, 39.58, 39.57, 39.58, 39.56, 39.55, 39.53, 39.52, 39.5, 39.53, 39.52, 39.51, 39.52, 39.52, 39.5, 39.55, 39.59, 39.56, 39.56, 39.62, 39.6, 39.55, 39.55, 39.59, 39.59, 39.59, 39.56, 39.56, 39.56, 39.54, 39.54, 39.55, 39.57, 39.58, 39.58, 39.58, 39.6, 39.6, 39.6, 39.6, 39.61, 39.6, 39.61, 39.6, 39.61, 39.6, 39.6, 39.55],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true,
                        pointRadius: 0
                    },
                    {
                        label: 'æˆäº¤å‡ä»·(VWAP)',
                        data: [39.20, 39.25, 39.31, 39.34, 39.37, 39.38, 39.38, 39.38, 39.38, 39.39, 39.40, 39.41, 39.42, 39.42, 39.42, 39.43, 39.43, 39.44, 39.45, 39.46, 39.47, 39.48, 39.51, 39.52, 39.55, 39.57, 39.59, 39.61, 39.65, 39.66, 39.66, 39.67, 39.67, 39.67, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.68, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.69, 39.68, 39.68, 39.68, 39.68, 39.68, 39.67, 39.67, 39.67, 39.67, 39.67, 39.67, 39.66, 39.66, 39.66, 39.66, 39.65, 39.65, 39.65, 39.65, 39.65, 39.64, 39.64, 39.64, 39.64, 39.64, 39.64, 39.64, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.63, 39.62, 39.62, 39.62, 39.61, 39.61, 39.61, 39.61, 39.61, 39.61, 39.60, 39.60, 39.60, 39.60, 39.60, 39.60, 39.58, 39.58, 39.58, 39.58, 39.58, 39.58, 39.58, 39.58, 39.58, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.56, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57, 39.57],
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: false,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14
                            },
                            padding: 15
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += 'Â¥' + context.parsed.y.toFixed(2);
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 12,
                            font: {
                                size: 11
                            }
                        }
                    },
                    y: {
                        position: 'right',
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            callback: function(value) {
                                return 'Â¥' + value.toFixed(2);
                            },
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // â”€â”€ åç¦»åº¦æŸ±çŠ¶å›¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const devCtx = document.getElementById('deviationChart').getContext('2d');
        const devData = [0.0, 0.371, 0.401, 0.247, 0.175, 0.157, 0.0, -0.025, -0.027, 0.133, 0.448, 0.249, 0.23, 0.173, 0.242, 0.185, 0.078, 0.41, 0.464, 0.53, 0.508, 0.608, 0.643, 0.753, 0.878, 0.888, 0.767, 0.902, 0.777, 0.485, 0.599, 0.509, 0.396, 0.266, 0.237, 0.084, 0.108, 0.006, 0.006, -0.019, -0.143, 0.059, -0.066, 0.06, 0.009, 0.235, 0.284, 0.255, 0.378, 0.35, 0.322, 0.343, 0.214, 0.237, 0.282, 0.355, 0.276, 0.199, 0.272, 0.169, 0.118, 0.117, -0.009, -0.034, -0.133, -0.157, -0.301, -0.374, -0.442, -0.488, -0.433, -0.478, -0.45, -0.522, -0.541, -0.513, -0.46, -0.355, -0.477, -0.645, -0.641, -0.658, -0.704, -0.698, -0.865, -0.786, -0.755, -0.701, -0.796, -0.792, -0.714, -0.659, -0.63, -0.626, -0.624, -0.62, -0.592, -0.54, -0.437, -0.633, -0.632, -0.678, -0.601, -0.574, -0.573, -0.595, -0.594, -0.738, -0.735, -0.707, -0.871, -0.842, -0.938, -0.983, -1.002, -0.973, -0.993, -1.013, -0.934, -0.93, -0.952, -0.952, -1.245, -1.038, -0.859, -0.882, -0.856, -0.829, -0.802, -0.774, -0.873, -0.971, -1.069, -1.016, -0.913, -0.784, -0.782, -0.781, -0.602, -0.6, -0.624, -0.547, -0.419, -0.468, -0.467, -0.441, -0.363, -0.21, -0.235, -0.234, -0.132, -0.157, 0.02, 0.071, 0.045, 0.17, 0.093, -0.033, 0.068, 0.067, -0.008, 0.067, 0.243, 0.192, 0.241, 0.34, 0.313, 0.085, 0.11, 0.185, 0.185, 0.058, 0.058, 0.058, 0.108, 0.032, 0.158, 0.257, 0.255, 0.178, 0.278, 0.201, 0.1, 0.1, -0.002, -0.052, -0.128, -0.026, -0.026, -0.026, -0.026, -0.076, -0.076, -0.076, -0.0, 0.025, -0.0, 0.025, -0.026, -0.051, -0.101, -0.126, -0.176, -0.1, -0.125, -0.15, -0.125, -0.124, -0.174, -0.048, 0.053, -0.022, -0.022, 0.129, 0.078, -0.049, -0.048, 0.053, 0.053, 0.052, -0.023, -0.023, -0.023, -0.074, -0.074, -0.048, 0.003, 0.028, 0.028, 0.027, 0.078, 0.078, 0.077, 0.077, 0.102, 0.076, 0.101, 0.075, 0.099, 0.074, 0.074, -0.051];
        const devColors = ['rgba(239,68,68,0.30)', 'rgba(239,68,68,0.49)', 'rgba(239,68,68,0.50)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.38)', 'rgba(239,68,68,0.30)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(239,68,68,0.37)', 'rgba(239,68,68,0.52)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.41)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.51)', 'rgba(239,68,68,0.53)', 'rgba(239,68,68,0.56)', 'rgba(239,68,68,0.55)', 'rgba(239,68,68,0.60)', 'rgba(239,68,68,0.62)', 'rgba(239,68,68,0.68)', 'rgba(239,68,68,0.74)', 'rgba(239,68,68,0.74)', 'rgba(239,68,68,0.68)', 'rgba(239,68,68,0.75)', 'rgba(239,68,68,0.69)', 'rgba(239,68,68,0.54)', 'rgba(239,68,68,0.60)', 'rgba(239,68,68,0.55)', 'rgba(239,68,68,0.50)', 'rgba(239,68,68,0.43)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.30)', 'rgba(239,68,68,0.30)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.37)', 'rgba(239,68,68,0.33)', 'rgba(34,197,94,0.33)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.30)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.44)', 'rgba(239,68,68,0.43)', 'rgba(239,68,68,0.49)', 'rgba(239,68,68,0.47)', 'rgba(239,68,68,0.46)', 'rgba(239,68,68,0.47)', 'rgba(239,68,68,0.41)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.44)', 'rgba(239,68,68,0.48)', 'rgba(239,68,68,0.44)', 'rgba(239,68,68,0.40)', 'rgba(239,68,68,0.44)', 'rgba(239,68,68,0.38)', 'rgba(239,68,68,0.36)', 'rgba(239,68,68,0.36)', 'rgba(34,197,94,0.30)', 'rgba(34,197,94,0.32)', 'rgba(34,197,94,0.37)', 'rgba(34,197,94,0.38)', 'rgba(34,197,94,0.45)', 'rgba(34,197,94,0.49)', 'rgba(34,197,94,0.52)', 'rgba(34,197,94,0.54)', 'rgba(34,197,94,0.52)', 'rgba(34,197,94,0.54)', 'rgba(34,197,94,0.53)', 'rgba(34,197,94,0.56)', 'rgba(34,197,94,0.57)', 'rgba(34,197,94,0.56)', 'rgba(34,197,94,0.53)', 'rgba(34,197,94,0.48)', 'rgba(34,197,94,0.54)', 'rgba(34,197,94,0.62)', 'rgba(34,197,94,0.62)', 'rgba(34,197,94,0.63)', 'rgba(34,197,94,0.65)', 'rgba(34,197,94,0.65)', 'rgba(34,197,94,0.73)', 'rgba(34,197,94,0.69)', 'rgba(34,197,94,0.68)', 'rgba(34,197,94,0.65)', 'rgba(34,197,94,0.70)', 'rgba(34,197,94,0.70)', 'rgba(34,197,94,0.66)', 'rgba(34,197,94,0.63)', 'rgba(34,197,94,0.61)', 'rgba(34,197,94,0.61)', 'rgba(34,197,94,0.61)', 'rgba(34,197,94,0.61)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.57)', 'rgba(34,197,94,0.52)', 'rgba(34,197,94,0.62)', 'rgba(34,197,94,0.62)', 'rgba(34,197,94,0.64)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.59)', 'rgba(34,197,94,0.59)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.67)', 'rgba(34,197,94,0.67)', 'rgba(34,197,94,0.65)', 'rgba(34,197,94,0.74)', 'rgba(34,197,94,0.72)', 'rgba(34,197,94,0.77)', 'rgba(34,197,94,0.79)', 'rgba(34,197,94,0.80)', 'rgba(34,197,94,0.79)', 'rgba(34,197,94,0.80)', 'rgba(34,197,94,0.81)', 'rgba(34,197,94,0.77)', 'rgba(34,197,94,0.77)', 'rgba(34,197,94,0.78)', 'rgba(34,197,94,0.78)', 'rgba(34,197,94,0.92)', 'rgba(34,197,94,0.82)', 'rgba(34,197,94,0.73)', 'rgba(34,197,94,0.74)', 'rgba(34,197,94,0.73)', 'rgba(34,197,94,0.71)', 'rgba(34,197,94,0.70)', 'rgba(34,197,94,0.69)', 'rgba(34,197,94,0.74)', 'rgba(34,197,94,0.79)', 'rgba(34,197,94,0.83)', 'rgba(34,197,94,0.81)', 'rgba(34,197,94,0.76)', 'rgba(34,197,94,0.69)', 'rgba(34,197,94,0.69)', 'rgba(34,197,94,0.69)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.60)', 'rgba(34,197,94,0.61)', 'rgba(34,197,94,0.57)', 'rgba(34,197,94,0.51)', 'rgba(34,197,94,0.53)', 'rgba(34,197,94,0.53)', 'rgba(34,197,94,0.52)', 'rgba(34,197,94,0.48)', 'rgba(34,197,94,0.40)', 'rgba(34,197,94,0.42)', 'rgba(34,197,94,0.42)', 'rgba(34,197,94,0.37)', 'rgba(34,197,94,0.38)', 'rgba(239,68,68,0.31)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.32)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.35)', 'rgba(34,197,94,0.32)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.33)', 'rgba(34,197,94,0.30)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.40)', 'rgba(239,68,68,0.42)', 'rgba(239,68,68,0.47)', 'rgba(239,68,68,0.46)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.32)', 'rgba(239,68,68,0.38)', 'rgba(239,68,68,0.43)', 'rgba(239,68,68,0.43)', 'rgba(239,68,68,0.39)', 'rgba(239,68,68,0.44)', 'rgba(239,68,68,0.40)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.35)', 'rgba(34,197,94,0.30)', 'rgba(34,197,94,0.33)', 'rgba(34,197,94,0.36)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.34)', 'rgba(34,197,94,0.34)', 'rgba(34,197,94,0.34)', 'rgba(239,68,68,0.30)', 'rgba(239,68,68,0.31)', 'rgba(239,68,68,0.30)', 'rgba(239,68,68,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.33)', 'rgba(34,197,94,0.35)', 'rgba(34,197,94,0.36)', 'rgba(34,197,94,0.39)', 'rgba(34,197,94,0.35)', 'rgba(34,197,94,0.36)', 'rgba(34,197,94,0.38)', 'rgba(34,197,94,0.36)', 'rgba(34,197,94,0.36)', 'rgba(34,197,94,0.39)', 'rgba(34,197,94,0.32)', 'rgba(239,68,68,0.33)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(239,68,68,0.36)', 'rgba(239,68,68,0.34)', 'rgba(34,197,94,0.32)', 'rgba(34,197,94,0.32)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.33)', 'rgba(239,68,68,0.33)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.31)', 'rgba(34,197,94,0.34)', 'rgba(34,197,94,0.34)', 'rgba(34,197,94,0.32)', 'rgba(239,68,68,0.30)', 'rgba(239,68,68,0.31)', 'rgba(239,68,68,0.31)', 'rgba(239,68,68,0.31)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.35)', 'rgba(239,68,68,0.34)', 'rgba(239,68,68,0.34)', 'rgba(34,197,94,0.33)'];

        new Chart(devCtx, {
            type: 'bar',
            data: {
                labels: ['0930', '0931', '0932', '0933', '0934', '0935', '0936', '0937', '0938', '0939', '0940', '0941', '0942', '0943', '0944', '0945', '0946', '0947', '0948', '0949', '0950', '0951', '0952', '0953', '0954', '0955', '0956', '0957', '0958', '0959', '1000', '1001', '1002', '1003', '1004', '1005', '1006', '1007', '1008', '1009', '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017', '1018', '1019', '1020', '1021', '1022', '1023', '1024', '1025', '1026', '1027', '1028', '1029', '1030', '1031', '1032', '1033', '1034', '1035', '1036', '1037', '1038', '1039', '1040', '1041', '1042', '1043', '1044', '1045', '1046', '1047', '1048', '1049', '1050', '1051', '1052', '1053', '1054', '1055', '1056', '1057', '1058', '1059', '1100', '1101', '1102', '1103', '1104', '1105', '1106', '1107', '1108', '1109', '1110', '1111', '1112', '1113', '1114', '1115', '1116', '1117', '1118', '1119', '1120', '1121', '1122', '1123', '1124', '1125', '1126', '1127', '1128', '1129', '1130', '1300', '1301', '1302', '1303', '1304', '1305', '1306', '1307', '1308', '1309', '1310', '1311', '1312', '1313', '1314', '1315', '1316', '1317', '1318', '1319', '1320', '1321', '1322', '1323', '1324', '1325', '1326', '1327', '1328', '1329', '1330', '1331', '1332', '1333', '1334', '1335', '1336', '1337', '1338', '1339', '1340', '1341', '1342', '1343', '1344', '1345', '1346', '1347', '1348', '1349', '1350', '1351', '1352', '1353', '1354', '1355', '1356', '1357', '1358', '1359', '1400', '1401', '1402', '1403', '1404', '1405', '1406', '1407', '1408', '1409', '1410', '1411', '1412', '1413', '1414', '1415', '1416', '1417', '1418', '1419', '1420', '1421', '1422', '1423', '1424', '1425', '1426', '1427', '1428', '1429', '1430', '1431', '1432', '1433', '1434', '1435', '1436', '1437', '1438', '1439', '1440', '1441', '1442', '1443', '1444', '1445', '1446', '1447', '1448', '1449', '1450', '1451', '1452', '1453', '1454', '1455', '1456', '1457', '1458', '1459', '1500'],
                datasets: [{
                    label: 'åç¦»åº¦(%)',
                    data: devData,
                    backgroundColor: devColors,
                    borderColor: devColors,
                    borderWidth: 0,
                    borderRadius: 2,
                    barPercentage: 0.9,
                    categoryPercentage: 1.0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.75)',
                        padding: 8,
                        callbacks: {
                            title: function(items) {
                                return items[0].label;
                            },
                            label: function(ctx) {
                                const v = ctx.parsed.y;
                                const arrow = v >= 0 ? 'â–² é«˜äºVWAP' : 'â–¼ ä½äºVWAP';
                                return arrow + '  ' + (v >= 0 ? '+' : '') + v.toFixed(3) + '%';
                            },
                            afterLabel: function(ctx) {
                                const v = ctx.parsed.y;
                                if (v <= -0.3) return 'ğŸ’¡ å‚è€ƒä¹°å…¥ä¿¡å·';
                                if (v >= 0.3)  return 'ğŸ’¡ å‚è€ƒå–å‡ºä¿¡å·';
                                return '';
                            }
                        }
                    },
                    annotation: { annotations: {} }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: 10,
                            font: { size: 10 },
                            color: '#aaa'
                        }
                    },
                    y: {
                        position: 'right',
                        grid: { color: 'rgba(0,0,0,0.04)' },
                        ticks: {
                            font: { size: 10 },
                            color: '#aaa',
                            callback: function(v) {
                                return (v >= 0 ? '+' : '') + v.toFixed(2) + '%';
                            }
                        },
                        afterDataLimits: function(scale) {
                            // å¯¹ç§°è½´ï¼Œæ­£è´Ÿç­‰å®½
                            const max = Math.max(Math.abs(scale.min), Math.abs(scale.max), 0.5);
                            scale.min = -max;
                            scale.max =  max;
                        }
                    }
                }
            }
        });

        // â”€â”€ æ“ä½œé¢æ¿é€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const API = 'http://127.0.0.1:18899';
        let currentPrice = 39.55;
        let currentVwap  = 39.5700449940552;

        // åˆå§‹åŒ–ï¼šåŠ è½½å½“å‰çŠ¶æ€
        async function loadState() {
            try {
                const r = await fetch(API + '/api/state', {signal: AbortSignal.timeout(2000)});
                const s = await r.json();
                renderState(s);
            } catch(e) {
                document.getElementById('positionBadge').textContent = 'æœ¬åœ°æœåŠ¡æœªå¯åŠ¨';
                document.getElementById('positionBadge').className = 'pos-badge pos-empty';
            }
        }

        function renderState(s) {
            const badge  = document.getElementById('positionBadge');
            const detail = document.getElementById('positionDetail');
            const btnBuy  = document.getElementById('btnBuy');
            const btnSell = document.getElementById('btnSell');

            // åŒæ­¥é…ç½®åˆ°è¾“å…¥æ¡†
            if (s.threshold) document.getElementById('cfgThreshold').value = s.threshold;
            if (s.quantity)  document.getElementById('cfgQuantity').value  = s.quantity;

            if (s.position === 'long') {
                badge.textContent = 'ğŸ“ˆ æŒä»“ä¸­';
                badge.className = 'pos-badge pos-long';
                const cost  = s.buy_price * s.quantity;
                const now   = currentPrice * s.quantity;
                const pnl   = (now - cost) * (1 - 0.0005);
                const pnlPct= (currentPrice - s.buy_price) / s.buy_price * 100;
                const sign  = pnl >= 0 ? '+' : '';
                detail.innerHTML = `ä¹°å…¥ Â¥${s.buy_price?.toFixed(2)} Ã— ${s.quantity}è‚¡
                    &nbsp;|&nbsp; å½“å‰ä»· Â¥${currentPrice.toFixed(2)}
                    &nbsp;|&nbsp; æµ®ç›ˆ <b style="color:${pnl>=0?'#2f9e44':'#e03131'}">${sign}Â¥${pnl.toFixed(0)}(${sign}${pnlPct.toFixed(2)}%)</b>
                    &nbsp;|&nbsp; ${s.buy_time?.substring(11,16)}å…¥åœº`;
                btnBuy.disabled  = true;
                btnSell.disabled = false;
            } else {
                badge.textContent = 'ç©ºä»“';
                badge.className = 'pos-badge pos-empty';
                detail.textContent = 'ç­‰å¾…ä¹°å…¥ä¿¡å·...';
                btnBuy.disabled  = false;
                btnSell.disabled = true;
            }

            renderTrades(s.today_trades || []);
        }

        function renderTrades(trades) {
            const el = document.getElementById('todayTrades');
            if (!trades.length) { el.innerHTML = ''; return; }

            const total = trades.reduce((s,t) => s + t.net_pnl, 0);
            const sign  = total >= 0 ? '+' : '';
            let html = `<div class="today-trades-title">
                ä»Šæ—¥æ“ä½œ ${trades.length} ç¬” &nbsp;|&nbsp;
                ç´¯è®¡å‡€æ”¶ç›Š: <b style="color:${total>=0?'#2f9e44':'#e03131'}">${sign}Â¥${total.toFixed(2)}</b>
            </div>`;

            trades.forEach((t,i) => {
                const win  = t.net_pnl >= 0;
                const sign = win ? '+' : '';
                html += `<div class="trade-record">
                    <span class="tr-badge ${win?'tr-win':'tr-loss'}">#${i+1} ${win?'ç›ˆ':'äº'}</span>
                    <span>${t.buy_time?.substring(11,16)}ä¹°å…¥ Â¥${t.buy_price?.toFixed(2)}</span>
                    <span>â†’ ${t.sell_time?.substring(11,16)}å–å‡º Â¥${t.sell_price?.toFixed(2)}</span>
                    <b style="color:${win?'#2f9e44':'#e03131'}">${sign}Â¥${t.net_pnl?.toFixed(2)}(${sign}${t.pnl_pct?.toFixed(3)}%)</b>
                    <span style="color:#aaa;font-size:.8em">æ‰‹ç»­è´¹Â¥${t.fee?.toFixed(2)}</span>
                </div>`;
            });
            el.innerHTML = html;
        }

        async function doTrade(type) {
            const btn = document.getElementById(type === 'buy' ? 'btnBuy' : 'btnSell');
            btn.disabled = true;
            btn.textContent = 'å¤„ç†ä¸­...';

            try {
                const r = await fetch(API + '/api/' + type, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({
                        price: currentPrice,
                        vwap:  currentVwap,
                        quantity: parseInt(document.getElementById('cfgQuantity').value) || 1000
                    })
                });
                const result = await r.json();

                if (result.ok) {
                    const el = document.getElementById('tradeResult');
                    el.style.display = 'block';
                    if (type === 'buy') {
                        el.className = 'trade-result win';
                        el.innerHTML = `âœ… <b>ä¹°å…¥å·²è®°å½•</b> &nbsp; ä»·æ ¼ Â¥${currentPrice.toFixed(2)} &nbsp; VWAP Â¥${currentVwap.toFixed(2)} &nbsp; åç¦» ${((currentPrice-currentVwap)/currentVwap*100).toFixed(3)}%`;
                    } else {
                        const t   = result.trade;
                        const win = t.net_pnl >= 0;
                        el.className = 'trade-result ' + (win ? 'win' : 'loss');
                        el.innerHTML = `${win?'âœ…':'âš ï¸'} <b>å–å‡ºå·²è®°å½•</b> &nbsp;
                            ä¹°å…¥Â¥${t.buy_price?.toFixed(2)} â†’ å–å‡ºÂ¥${t.sell_price?.toFixed(2)} &nbsp;|&nbsp;
                            å‡€æ”¶ç›Š <b style="color:${win?'#2f9e44':'#e03131'}">${win?'+':''}Â¥${t.net_pnl?.toFixed(2)}(${win?'+':''}${t.pnl_pct?.toFixed(3)}%)</b> &nbsp;|&nbsp;
                            æ‰‹ç»­è´¹Â¥${t.fee?.toFixed(2)}`;
                    }
                    setTimeout(loadState, 300);
                } else {
                    alert('æ“ä½œå¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch(e) {
                alert('âŒ è¿æ¥æœ¬åœ°æœåŠ¡å¤±è´¥ï¼Œè¯·ç¡®è®¤æœåŠ¡å·²å¯åŠ¨\n\næœ¬åœ°æœåŠ¡ç«¯å£: 18899\nå¯åŠ¨å‘½ä»¤:\npython3 /root/.openclaw/workspace/trade_api_server.py &');
            }
            btn.disabled = false;
            btn.textContent = type === 'buy' ? 'âœ… å·²ä¹°å…¥ï¼ˆè®°å½•ï¼‰' : 'ğŸ”´ å·²å–å‡ºï¼ˆè®°å½•ï¼‰';
        }

        async function saveConfig() {
            const threshold = parseFloat(document.getElementById('cfgThreshold').value);
            const quantity  = parseInt(document.getElementById('cfgQuantity').value);
            try {
                const r = await fetch(API + '/api/config', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({threshold, quantity})
                });
                const result = await r.json();
                if (result.ok) {
                    alert(`âœ… é…ç½®å·²ä¿å­˜\né˜ˆå€¼: ${result.threshold}%\næŒä»“: ${result.quantity}è‚¡\næ¨é€é€šçŸ¥å°†ä½¿ç”¨æ–°é˜ˆå€¼`);
                }
            } catch(e) {
                alert('âŒ è¿æ¥æœ¬åœ°æœåŠ¡å¤±è´¥ï¼Œè¯·å¯åŠ¨æœåŠ¡');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è·å–çŠ¶æ€
        loadState();
        // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æŒä»“çŠ¶æ€
        setInterval(loadState, 30000);
    </script>
</body>
</html>